// https://github.com/empear-analytics/the-book v0.0.1 Copyright 2022 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).book={})}(this,(function(e){"use strict";var t=(()=>{const e="the-book--style",t="_none",n={styles:new Map};function a(){return document.querySelector(`head style#${e}`)}function r(e){return n.styles.has(e)||n.styles.set(e,new Map),n.styles.get(e)}function o(){let t=a();return null===t&&(t=document.createElement("style"),t.id=e,document.head.appendChild(t)),t}function i(e){return Array.from(e.entries()).sort(((e,t)=>e[0].localeCompare(t[0])))}function d(){return i(n.styles).map((([e,n])=>{let a=i(n).map((([e,t])=>`${e}{${Object.entries(t).map((e=>`${e[0]}:${e[1]}`)).join(";")}}`)).join("");return e!==t&&(a=`${e}{${a}}`),a})).join("")}function s(e,t,n){const a=r(n),o=a.get(e)||{};a.set(e,Object.assign(o,t))}const l={add:(e,t,n="_none")=>(r(n).has(e)&&null!==a()||(s(e,t,n),o().textContent=d()),l),update:(e,t,n="_none")=>(s(e,t,n),o().textContent=d(),l)};return l})();const n="the-book";var a={header:`${n}--header`,footer:`${n}--footer`,margins:{left:`${n}--margins--side-left`,right:`${n}--margins--side-right`},page:{outer:`${n}--page-outer`,content:`${n}--page-content`,inner:`${n}--page-inner`}};function r(e){t.add("."+a.margins[e],{width:"150mm",height:"237mm",margin:"30mm"});const n={margins:{left:30,right:30,top:30,bottom:30}};function r(e=210){return e-n.margins.left-n.margins.right}function o(e=297){return e-n.margins.top-n.margins.bottom}function i(){return`${n.margins.top}mm ${n.margins.right}mm ${n.margins.bottom}mm ${n.margins.left}mm`}return{getWidth:r,getHeight:o,toStyle:i,update(d){n.margins=Object.assign(n.margins,d),t.update("."+a.margins[e],{width:r()+"mm",height:o()+"mm",margin:i()})}}}function o(e){const t=document.createElement(e?.tag||"div");return e?.classNames&&t.classList.add(...e.classNames),t.innerHTML=e?.html||"",Object.entries(e?.style||{}).forEach((([e,n])=>{t.style.setProperty(e,n)})),t}var i=(()=>{const e={scale:void 0};return t=>t*function(){if(void 0===e.scale){const t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="1mm",t.style.height="100mm",document.body.appendChild(t),e.scale=t.getBoundingClientRect().height/100}return e.scale}()})();function d(e,n){t.add("p",{padding:"3mm 0"});const a={indent:n,el:o({tag:"p",style:{margin:0,"text-indent":n||null},html:e})},r={appendTo:e=>(e.appendChild(a.el),r),text:function(e){return void 0===e?a.el.innerHTML:(a.el.innerHTML=e,r)},calculateOverflow:e=>{const t=a.el.innerHTML.split(" "),n=a.el.parentNode;let r=0,o=t.length,i=o;do{a.el.innerHTML=t.slice(0,i).join(" "),n.scrollHeight>e?(o=i,i=Math.floor((r+o)/2)):(r=i,i=Math.floor((r+o)/2))}while(i!==r&&i!==o);for(;n.scrollHeight>e;)i--,a.el.innerHTML=t.slice(0,i).join(" ");return i<t.length?d(t.slice(i).join(" ")):void 0}};return r}e.Book=function(e){document.title=e,t.add("html,body",{margin:0,padding:0,background:"#ddd","-webkit-print-color-adjust":"exact","-webkit-filter":"opacity(1)"}).add("html,body",{margin:"0 !important",padding:0,"box-shadow":"none"},"@media print").add("."+a.header,{position:"absolute",top:0,left:0,width:"100%"}).add("."+a.footer,{position:"absolute",bottom:0,left:0,width:"100%"});const n={margins:{leftPage:r("left"),rightPage:r("right")},width:210,height:297,pages:{all:[],current:void 0},header:void 0,footer:void 0},s={page:e=>n.pages.all[e],leftPageMargins:e=>void 0===e?n.margins.leftPage:(n.margins.leftPage.update(e),s),rightPageMargins:e=>void 0===e?n.margins.rightPage:(n.margins.rightPage.update(e),s),header:e=>void 0===e?n.header:(n.header=e,s),footer:e=>void 0===e?n.footer:(n.footer=e,s),width:()=>n.width,height:()=>n.height};return s.addPage=(e={header:!0,footer:!0})=>(n.pages.current=function(e){t.add("."+a.page.outer,{display:"block",position:"relative",width:"210mm",height:"297mm",margin:"50px",overflow:"hidden",background:"#fff","box-shadow":"0 0 30px #bbb","page-break-after":"always"}).add("."+a.page.outer,{margin:0,width:"210mm",height:"296mm",overflow:"hidden","padding-bottom":"3px","box-shadow":"none","page-break-after":"always"},"@media print").add("."+a.page.content,{position:"absolute",top:0,left:0,overflow:"hidden"});const n=(()=>{const t=e.numberOfPages()%2==0?"left":"right",n=document.body.appendChild(o({classNames:[a.page.outer]})),r=n.appendChild(o({classNames:[a.page.content,a.margins[t]]}));return{outer:n,inner:r.appendChild(o({classNames:[a.page.inner]})),margins:"left"===t?e.leftPageMargins():e.rightPageMargins(),caret:{height:0}}})(),r={addHeader:()=>{const t=e.header();return n.outer.appendChild(o({classNames:[a.header],html:t({number:e.numberOfPages()})})),r},addFooter:()=>{const t=e.footer();return n.outer.appendChild(o({classNames:[a.footer],html:t({number:e.numberOfPages()})})),r},addParagraph:t=>(n.caret.height=n.inner.scrollHeight,t.appendTo(n.inner).calculateOverflow(i(n.margins.getHeight(e.height()))))};return r}(s),n.pages.all.push(n.pages.current),e?.header&&n.header&&n.pages.current.addHeader(),e?.footer&&n.footer&&n.pages.current.addFooter(),s),s.writeParagraph=e=>{let t=d(e,"5mm");0===n.pages.all.length&&s.addPage();do{t=n.pages.current.addParagraph(t),void 0!==t&&s.addPage()}while(void 0!==t);return s},s.numberOfPages=()=>n.pages.all.length,s},Object.defineProperty(e,"__esModule",{value:!0})}));
