// https://github.com/empear-analytics/boken v0.0.1 Copyright 2022 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).boken={})}(this,(function(e){"use strict";var t=(()=>{const e="boken--style",t="_none",n={styles:new Map};function a(){return document.querySelector(`head style#${e}`)}function r(e){return n.styles.has(e)||n.styles.set(e,new Map),n.styles.get(e)}function o(){let t=a();return null===t&&(t=document.createElement("style"),t.id=e,document.head.appendChild(t)),t}function i(e){return Array.from(e.entries()).sort(((e,t)=>e[0].localeCompare(t[0])))}function d(){return i(n.styles).map((([e,n])=>{let a=i(n).map((([e,t])=>`${e}{${Object.entries(t).map((e=>`${e[0]}:${e[1]}`)).join(";")}}`)).join("");return e!==t&&(a=`${e}{${a}}`),a})).join("")}function s(e,t,n){const a=r(n),o=a.get(e)||{};a.set(e,Object.assign(o,t))}const l={add:(e,t,n="_none")=>(r(n).has(e)&&null!==a()||(s(e,t,n),o().textContent=d()),l),update:(e,t,n="_none")=>(s(e,t,n),o().textContent=d(),l)};return l})();var n={header:"boken--header",footer:"boken--footer",margins:{left:"boken--margins--side-left",right:"boken--margins--side-right"},page:{outer:"boken--page-outer",content:"boken--page-content",inner:"boken--page-inner"}};function a(e){t.add("."+n.margins[e],{width:"150mm",height:"237mm",margin:"30mm"});const a={margins:{left:30,right:30,top:30,bottom:30}};function r(e=210){return e-a.margins.left-a.margins.right}function o(e=297){return e-a.margins.top-a.margins.bottom}function i(){return`${a.margins.top}mm ${a.margins.right}mm ${a.margins.bottom}mm ${a.margins.left}mm`}return{getWidth:r,getHeight:o,toStyle:i,update(d){a.margins=Object.assign(a.margins,d),t.update("."+n.margins[e],{width:r()+"mm",height:o()+"mm",margin:i()})}}}function r(e){const t=document.createElement(e?.tag||"div");return e?.classNames&&t.classList.add(...e.classNames),t.innerHTML=e?.html||"",Object.entries(e?.style||{}).forEach((([e,n])=>{t.style.setProperty(e,n)})),t}var o=(()=>{const e={scale:void 0};return t=>t*function(){if(void 0===e.scale){const t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="1mm",t.style.height="100mm",document.body.appendChild(t),e.scale=t.getBoundingClientRect().height/100}return e.scale}()})();function i(e,n){t.add("p",{padding:"3mm 0"});const a={indent:n,el:r({tag:"p",style:{margin:0,"text-indent":n||null},html:e})},o={appendTo:e=>(e.appendChild(a.el),o),text:function(e){return void 0===e?a.el.innerHTML:(a.el.innerHTML=e,o)},calculateOverflow:e=>{const t=a.el.innerHTML.split(" "),n=a.el.parentNode;let r=0,o=t.length,d=o;do{a.el.innerHTML=t.slice(0,d).join(" "),n.scrollHeight>e?(o=d,d=Math.floor((r+o)/2)):(r=d,d=Math.floor((r+o)/2))}while(d!==r&&d!==o);for(;n.scrollHeight>e;)d--,a.el.innerHTML=t.slice(0,d).join(" ");return d<t.length?i(t.slice(d).join(" ")):void 0}};return o}e.Book=function(e){document.title=e,t.add("html,body",{margin:0,padding:0,background:"#ddd","-webkit-print-color-adjust":"exact","-webkit-filter":"opacity(1)"}).add("html,body",{margin:"0 !important",padding:0,"box-shadow":"none"},"@media print").add("."+n.header,{position:"absolute",top:0,left:0,width:"100%"}).add("."+n.footer,{position:"absolute",bottom:0,left:0,width:"100%"});const d={margins:{leftPage:a("left"),rightPage:a("right")},width:210,height:297,pages:{all:[],current:void 0},header:void 0,footer:void 0},s={page:e=>d.pages.all[e],leftPageMargins:e=>void 0===e?d.margins.leftPage:(d.margins.leftPage.update(e),s),rightPageMargins:e=>void 0===e?d.margins.rightPage:(d.margins.rightPage.update(e),s),header:e=>void 0===e?d.header:(d.header=e,s),footer:e=>void 0===e?d.footer:(d.footer=e,s),width:()=>d.width,height:()=>d.height};return s.addPage=(e={header:!0,footer:!0})=>(d.pages.current=function(e){t.add("."+n.page.outer,{display:"block",position:"relative",width:"210mm",height:"297mm",margin:"50px",overflow:"hidden",background:"#fff","box-shadow":"0 0 30px #bbb","page-break-after":"always"}).add("."+n.page.outer,{margin:0,width:"210mm",height:"296mm",overflow:"hidden","padding-bottom":"3px","box-shadow":"none","page-break-after":"always"},"@media print").add("."+n.page.content,{position:"absolute",top:0,left:0,overflow:"hidden"});const a=(()=>{const t=e.numberOfPages()%2==0?"left":"right",a=document.body.appendChild(r({classNames:[n.page.outer]})),o=a.appendChild(r({classNames:[n.page.content,n.margins[t]]}));return{outer:a,inner:o.appendChild(r({classNames:[n.page.inner]})),margins:"left"===t?e.leftPageMargins():e.rightPageMargins(),caret:{height:0}}})(),i={addHeader:()=>{const t=e.header();return a.outer.appendChild(r({classNames:[n.header],html:t({number:e.numberOfPages()})})),i},addFooter:()=>{const t=e.footer();return a.outer.appendChild(r({classNames:[n.footer],html:t({number:e.numberOfPages()})})),i},addParagraph:t=>(a.caret.height=a.inner.scrollHeight,t.appendTo(a.inner).calculateOverflow(o(a.margins.getHeight(e.height()))))};return i}(s),d.pages.all.push(d.pages.current),e?.header&&d.header&&d.pages.current.addHeader(),e?.footer&&d.footer&&d.pages.current.addFooter(),s),s.writeParagraph=e=>{let t=i(e,"5mm");0===d.pages.all.length&&s.addPage();do{t=d.pages.current.addParagraph(t),void 0!==t&&s.addPage()}while(void 0!==t);return s},s.numberOfPages=()=>d.pages.all.length,s},Object.defineProperty(e,"__esModule",{value:!0})}));
