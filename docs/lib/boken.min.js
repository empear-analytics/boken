// https://github.com/empear-analytics/boken v0.0.2 Copyright 2023 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).boken={})}(this,(function(e){"use strict";var t=(()=>{const e="boken--style",t="_none",n={styles:new Map};function r(){return document.querySelector(`head style#${e}`)}function a(e){return n.styles.has(e)||n.styles.set(e,new Map),n.styles.get(e)}function o(){let t=r();return null===t&&(t=document.createElement("style"),t.id=e,document.head.appendChild(t)),t}function i(e){return Array.from(e.entries()).sort(((e,t)=>e[0].localeCompare(t[0])))}function d(){return i(n.styles).map((([e,n])=>{let r=i(n).map((([e,t])=>`${e}{${Object.entries(t).map((e=>`${e[0]}:${e[1]}`)).join(";")}}`)).join("");return e!==t&&(r=`${e}{${r}}`),r})).join("")}function s(e,t,n){const r=a(n),o=r.get(e)||{};r.set(e,Object.assign(o,t))}const l={add:(e,t,n="_none")=>(a(n).has(e)&&null!==r()||(s(e,t,n),o().textContent=d()),l),update:(e,t,n="_none")=>(s(e,t,n),o().textContent=d(),l)};return l})();var n={header:"boken--header",footer:"boken--footer",margins:{left:"boken--margins--side-left",right:"boken--margins--side-right"},page:{outer:"boken--page-outer",content:"boken--page-content",inner:"boken--page-inner"}};function r(e){t.add("."+n.margins[e],{width:"150mm",height:"237mm",margin:"30mm"});const r={margins:{left:30,right:30,top:30,bottom:30}};function a(e=210){return e-r.margins.left-r.margins.right}function o(e=297){return e-r.margins.top-r.margins.bottom}function i(){return`${r.margins.top}mm ${r.margins.right}mm ${r.margins.bottom}mm ${r.margins.left}mm`}return{getWidth:a,getHeight:o,toStyle:i,update(d){r.margins=Object.assign(r.margins,d),t.update("."+n.margins[e],{width:a()+"mm",height:o()+"mm",margin:i()})}}}function a(e){const t=document.createElement(e?.tag||"div");return e?.classNames&&t.classList.add(...e.classNames),t.innerHTML=e?.html||"",Object.entries(e?.style||{}).forEach((([e,n])=>{t.style.setProperty(e,n)})),t}var o=(()=>{const e={scale:void 0};return t=>t*function(){if(void 0===e.scale){const t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="1mm",t.style.height="100mm",document.body.appendChild(t),e.scale=t.getBoundingClientRect().height/100}return e.scale}()})();function i(e,n){t.add("p",{padding:"3mm 0"});const r={indent:n,el:a({tag:"p",style:{margin:0,"text-indent":n||null},html:e})},o={appendTo:e=>(e.appendChild(r.el),o),text:function(e){return void 0===e?r.el.innerHTML:(r.el.innerHTML=e,o)},calculateOverflow:e=>{const t=r.el.innerHTML.split(" "),n=r.el.parentNode;let a=0,o=t.length,d=o;do{r.el.innerHTML=t.slice(0,d).join(" "),n.scrollHeight>e?(o=d,d=Math.floor((a+o)/2)):(a=d,d=Math.floor((a+o)/2))}while(d!==a&&d!==o);for(;n.scrollHeight>e;)d--,r.el.innerHTML=t.slice(0,d).join(" ");return d<t.length?i(t.slice(d).join(" ")):void 0}};return o}e.Book=function(e){document.title=e,t.add("html,body",{margin:0,padding:0,background:"#ddd","-webkit-print-color-adjust":"exact","-webkit-filter":"opacity(1)"}).add("html,body",{margin:"0 !important",padding:0,"box-shadow":"none"},"@media print").add("."+n.header,{position:"absolute",top:0,left:0,width:"100%"}).add("."+n.footer,{position:"absolute",bottom:0,left:0,width:"100%"});const d={margins:{leftPage:r("left"),rightPage:r("right")},width:210,height:297,pages:{all:[],current:void 0},header:void 0,footer:void 0},s={write:{},margins:{},page:e=>d.pages.all[e]};return s.margins.leftPage=e=>void 0===e?d.margins.leftPage:(d.margins.leftPage.update(e),s),s.margins.rightPage=e=>void 0===e?d.margins.rightPage:(d.margins.rightPage.update(e),s),s.header=e=>void 0===e?d.header:(d.header=e,s),s.footer=e=>void 0===e?d.footer:(d.footer=e,s),s.width=()=>d.width,s.height=()=>d.height,s.addPage=(e={header:!0,footer:!0})=>(d.pages.current=function(e){t.add("."+n.page.outer,{display:"block",position:"relative",width:"210mm",height:"297mm",margin:"50px",overflow:"hidden",background:"#fff","box-shadow":"0 0 30px #bbb","page-break-after":"always"}).add("."+n.page.outer,{margin:0,width:"210mm",height:"296mm",overflow:"hidden","padding-bottom":"3px","box-shadow":"none","page-break-after":"always"},"@media print").add("."+n.page.content,{position:"absolute",top:0,left:0,overflow:"hidden"});const r=(()=>{const t=e.numberOfPages()%2==0?"left":"right",r=document.body.appendChild(a({classNames:[n.page.outer]})),o=r.appendChild(a({classNames:[n.page.content,n.margins[t]]}));return{outer:r,inner:o.appendChild(a({classNames:[n.page.inner]})),margins:"left"===t?e.margins.leftPage():e.margins.rightPage(),caret:{height:0}}})(),i={addHeader:()=>{const t=e.header();return r.outer.appendChild(a({classNames:[n.header],html:t({number:e.numberOfPages()})})),i},addFooter:()=>{const t=e.footer();return r.outer.appendChild(a({classNames:[n.footer],html:t({number:e.numberOfPages()})})),i},addParagraph:t=>(r.caret.height=r.inner.scrollHeight,t.appendTo(r.inner).calculateOverflow(o(r.margins.getHeight(e.height())))),_inner:()=>r.inner};return i}(s),d.pages.all.push(d.pages.current),e?.header&&d.header&&d.pages.current.addHeader(),e?.footer&&d.footer&&d.pages.current.addFooter(),s),s.write.p=(e,t)=>{let n=i(e,("number"==typeof t?t:5)+"mm");0===d.pages.all.length&&s.addPage();do{n=d.pages.current.addParagraph(n),void 0!==n&&s.addPage()}while(void 0!==n);return s},s.numberOfPages=()=>d.pages.all.length,s},Object.defineProperty(e,"__esModule",{value:!0})}));
