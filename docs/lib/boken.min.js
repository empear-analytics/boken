// https://github.com/empear-analytics/boken v0.0.2 Copyright 2022 Enys Mones
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).boken={})}(this,(function(e){"use strict";var t=(()=>{const e="boken--style",t="_none",n={styles:new Map};function a(){return document.querySelector(`head style#${e}`)}function r(e){return n.styles.has(e)||n.styles.set(e,new Map),n.styles.get(e)}function i(){let t=a();return null===t&&(t=document.createElement("style"),t.id=e,document.head.appendChild(t)),t}function o(e){return Array.from(e.entries()).sort(((e,t)=>e[0].localeCompare(t[0])))}function d(){return o(n.styles).map((([e,n])=>{let a=o(n).map((([e,t])=>`${e}{${Object.entries(t).map((e=>`${e[0]}:${e[1]}`)).join(";")}}`)).join("");return e!==t&&(a=`${e}{${a}}`),a})).join("")}function s(e,t,n){const a=r(n),i=a.get(e)||{};a.set(e,Object.assign(i,t))}const l={add:(e,t,n="_none")=>(r(n).has(e)&&null!==a()||(s(e,t,n),i().textContent=d()),l),update:(e,t,n="_none")=>(s(e,t,n),i().textContent=d(),l)};return l})();var n={header:"boken--header",footer:"boken--footer",margins:{left:"boken--margins--left-page",right:"boken--margins--right-page"},page:{outer:"boken--page-outer",content:"boken--page-content",inner:"boken--page-inner"},marginNote:"boken--margin-note"};function a(e){t.add("."+n.margins[e],{width:"150mm",height:"237mm",margin:"30mm"});const a={margins:{left:30,right:30,top:30,bottom:30}};function r(e=210){return e-a.margins.left-a.margins.right}function i(e=297){return e-a.margins.top-a.margins.bottom}function o(){return`${a.margins.top}mm ${a.margins.right}mm ${a.margins.bottom}mm ${a.margins.left}mm`}return{left:()=>a.margins.left,right:()=>a.margins.right,getWidth:r,getHeight:i,toStyle:o,update(d){a.margins=Object.assign(a.margins,d),t.update("."+n.margins[e],{width:r()+"mm",height:i()+"mm",margin:o()})}}}function r(e){const t=document.createElement(e?.tag||"div");return e?.classNames&&t.classList.add(...e.classNames),t.innerHTML=e?.html||"",Object.entries(e?.style||{}).forEach((([e,n])=>{t.style.setProperty(e,n)})),t}var i=(()=>{const e={scale:void 0};return t=>t*function(){if(void 0===e.scale){const t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="1mm",t.style.height="100mm",document.body.appendChild(t),e.scale=t.getBoundingClientRect().height/100}return e.scale}()})(),o=function(e){t.add("."+n.marginNote,{position:"absolute",margin:"5mm"});const a={el:r({tag:"div",classNames:[n.marginNote]})};e.outer.appendChild(a.el);const i={content:e=>(a.el.innerHTML=e,i),side:t=>(a.el.style[t]=0,a.el.style.width=`calc(${e.margins[t]()}mm - 10mm)`,i),position:e=>(a.el.style.top=e,i)};return i};function d(e,n){t.add("p",{padding:"3mm 0"});const a={el:r({tag:"p",style:{margin:0,"text-indent":n.indent||null},html:e})},i={appendTo:e=>(e.appendChild(a.el),i),calculateOverflow:e=>{const t=a.el.innerHTML.split(" "),r=a.el.parentNode;let i=0,o=t.length,s=o;do{a.el.innerHTML=t.slice(0,s).join(" "),r.scrollHeight>e?(o=s,s=Math.floor((i+o)/2)):(i=s,s=Math.floor((i+o)/2))}while(s!==i&&s!==o);for(;r.scrollHeight>e;)s--,a.el.innerHTML=t.slice(0,s).join(" ");return s<t.length?d(t.slice(s).join(" "),Object.assign(n,{indent:null})):void 0}};return i}e.Book=function(e){document.title=e,t.add("html,body",{margin:0,padding:0,background:"#ddd","-webkit-print-color-adjust":"exact","-webkit-filter":"opacity(1)"}).add("html,body",{margin:"0 !important",padding:0,"box-shadow":"none"},"@media print").add("."+n.header,{position:"absolute",top:0,left:0,width:"100%"}).add("."+n.footer,{position:"absolute",bottom:0,left:0,width:"100%"});const s={margins:{leftPage:a("left"),rightPage:a("right")},width:210,height:297,pages:{all:[],current:void 0},header:void 0,footer:void 0},l={write:{},page:e=>s.pages.all[e],leftPageMargins:e=>void 0===e?s.margins.leftPage:(s.margins.leftPage.update(e),l),rightPageMargins:e=>void 0===e?s.margins.rightPage:(s.margins.rightPage.update(e),l),header:e=>void 0===e?s.header:(s.header=e,l),footer:e=>void 0===e?s.footer:(s.footer=e,l),width:()=>s.width,height:()=>s.height};return l.addPage=(e={header:!0,footer:!0})=>(s.pages.current=function(e){t.add("."+n.page.outer,{display:"block",position:"relative",width:"210mm",height:"297mm",margin:"50px",overflow:"hidden",background:"#fff","box-shadow":"0 0 30px #bbb","page-break-after":"always"}).add("."+n.page.outer,{margin:0,width:"210mm",height:"296mm",overflow:"hidden","padding-bottom":"3px","box-shadow":"none","page-break-after":"always"},"@media print").add("."+n.page.content,{position:"absolute",top:0,left:0,overflow:"hidden"});const a=(()=>{const t=e.pages.all.length%2==0?"left":"right",a=document.body.appendChild(r({classNames:[n.page.outer]})),i=a.appendChild(r({classNames:[n.page.content,n.margins[t]]}));return{side:t,outer:a,inner:i.appendChild(r({classNames:[n.page.inner]})),margins:"left"===t?e.margins.leftPage:e.margins.rightPage,caret:{height:0}}})(),d={addHeader:()=>{const t=e.header;return a.outer.appendChild(r({classNames:[n.header],html:t({number:e.pages.all.length})})),d},addFooter:()=>{const t=e.footer;return a.outer.appendChild(r({classNames:[n.footer],html:t({number:e.pages.all.length})})),d},addParagraph:t=>(a.caret.height=a.inner.scrollHeight,t.appendTo(a.inner).calculateOverflow(i(a.margins.getHeight(e.height)))),addMarginNote:()=>o(a).side(a.side)};return d}(s),s.pages.all.push(s.pages.current),e?.header&&s.header&&s.pages.current.addHeader(),e?.footer&&s.footer&&s.pages.current.addFooter(),l),l.write.p=(e,t)=>{let n=d(e,Object.assign({indent:"5mm"},t));0===s.pages.all.length&&l.addPage();do{n=s.pages.current.addParagraph(n),void 0!==n&&l.addPage()}while(void 0!==n);return l},l.write.marginNote=()=>s.pages.current.addMarginNote(),l.numberOfPages=()=>s.pages.all.length,l},Object.defineProperty(e,"__esModule",{value:!0})}));
